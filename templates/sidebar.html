{% load static %}

{% block sidebar %}
<!-- Overlay para cerrar sidebar en móvil -->
<div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden transition-opacity duration-300"></div>

<!-- Sidebar con Tailwind CSS -->
<aside id="sidebar" class="fixed lg:sticky top-0 left-0 h-screen flex flex-col bg-white border-r border-gray-200 transition-all duration-300 ease-in-out z-50 shadow-xl lg:shadow-none flex-shrink-0 -translate-x-full lg:translate-x-0" style="width: 260px;">
    
    <!-- Sidebar Header -->
    <div id="sidebarHeader" class="p-4 flex items-center justify-between border-b border-gray-200 flex-shrink-0 bg-gradient-to-r from-blue-600 to-blue-700">
        <a href="{% url 'core:home' %}" class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="2" y1="12" x2="22" y2="12"></line>
                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                </svg>
            </div>
            <span class="text-xl font-bold text-white whitespace-nowrap">Luminet</span>
        </a>
        
        <!-- Botón cerrar solo en móvil -->
        <button id="closeSidebarBtn" class="p-2 rounded-lg hover:bg-blue-800 transition-colors duration-200 lg:hidden">
            <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>

    <!-- Sidebar Menu -->
    <ul class="flex-1 overflow-y-auto py-4 space-y-1 px-3 sidebar-scroll">
    </ul>

    <!-- Sidebar Footer - User Profile -->
    <div id="sidebarFooter" class="border-t border-gray-200 p-4 flex-shrink-0 bg-gray-50">
        <div id="info_profile" class="flex items-center space-x-3">
            <div class="flex-shrink-0">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold shadow-md">
                    {{ user.get_short_name.0|upper }}
                </div>
            </div>
            
            <div class="flex-1 min-w-0 overflow-hidden">
                <p class="text-sm font-semibold text-gray-900 truncate">
                    {{ user.get_short_name }}
                </p>
                {% if request.user.groups.first %}
                <p class="text-xs text-gray-500 truncate">
                    {{ request.user.groups.first }}
                </p>
                {% endif %}
            </div>
            
            <div class="flex-shrink-0">
                <a href="{% url 'login:logout' %}" class="p-2 rounded-lg hover:bg-red-50 transition-colors duration-200 group inline-block" title="Cerrar sesión">
                    <svg class="w-5 h-5 text-gray-500 group-hover:text-red-600 transition-colors duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</aside>

<!-- Scripts del Sidebar -->
<script>
$(document).ready(function () {
    // Resaltar enlace activo según la ruta actual
    const currentPath = "{{ list_url }}";
    $(".nav-customitem").each(function () {
        const isActive = $(this).attr("href") === currentPath;
        $(this).toggleClass("active", isActive);
    });
    
    // Funcionalidad para abrir/cerrar sidebar en móvil
    function openSidebar() {
        $('#sidebar').removeClass('-translate-x-full');
        $('#sidebarOverlay').removeClass('hidden');
        $('body').addClass('overflow-hidden lg:overflow-auto');
    }
    
    function closeSidebar() {
        $('#sidebar').addClass('-translate-x-full');
        $('#sidebarOverlay').addClass('hidden');
        $('body').removeClass('overflow-hidden');
    }
    
    // Botón del header para abrir sidebar (solo móvil)
    $('#openSidebarBtn').click(function() {
        openSidebar();
    });
    
    // Botón para cerrar sidebar
    $('#closeSidebarBtn').click(function() {
        closeSidebar();
    });
    
    // Cerrar al hacer click en el overlay
    $('#sidebarOverlay').click(function() {
        closeSidebar();
    });
    
    // Cerrar sidebar al hacer click en un enlace (solo en móvil)
    $('.nav-customitem').click(function() {
        if (window.innerWidth < 1024) {
            closeSidebar();
        }
    });
});

// Rotar flechas en submenús
document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.submenu').forEach(function(submenu) {
        const trigger = document.querySelector(`[data-submenu-target='${submenu.id}']`);
        
        if (trigger) {
            trigger.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const arrow = trigger.querySelector('.arrow-icon');
                const isHidden = submenu.classList.contains('hidden');
                
                if (isHidden) {
                    submenu.classList.remove('hidden');
                    if (arrow) {
                        arrow.style.transform = 'rotate(90deg)';
                    }
                } else {
                    submenu.classList.add('hidden');
                    if (arrow) {
                        arrow.style.transform = 'rotate(0deg)';
                    }
                }
            });
        }
    });
});
</script>
{% endblock sidebar %}