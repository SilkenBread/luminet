# Docker Compose para PRODUCCIÓN
# Uso: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  web:
    # No montar código fuente en producción
    volumes:
      - static_volume:/luminet/staticfiles
      - media_volume:/luminet/media
      - ./db.sqlite3:/luminet/db.sqlite3
    
    # Usar comando por defecto del Dockerfile (Gunicorn)
    command: >
      sh -c "python manage.py migrate &&
             python manage.py collectstatic --noinput &&
             gunicorn config.wsgi:application 
             --bind 0.0.0.0:8000 
             --workers 4 
             --timeout 120 
             --access-logfile - 
             --error-logfile - 
             --log-level info"
    
    environment:
      - DEBUG=False
      - DJANGO_SETTINGS_MODULE=config.settings
    
    restart: always

# Para el futuro si se quiere agregar PostgreSQL, Nginx, Redis, etc.
# Puedes descomentar y configurar:

#   db:
#     image: postgres:16-alpine
#     container_name: luminet_db
#     restart: always
#     environment:
#       - POSTGRES_DB=luminet
#       - POSTGRES_USER=postgres
#       - POSTGRES_PASSWORD=${DB_PASSWORD:-postgres}
#     volumes:
#       - postgres_data:/var/lib/postgresql/data
#     networks:
#       - luminet-network
#
#   nginx:
#     image: nginx:alpine
#     container_name: luminet_nginx
#     restart: always
#     ports:
#       - "80:80"
#       - "443:443"
#     volumes:
#       - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
#       - static_volume:/luminet/staticfiles:ro
#       - media_volume:/luminet/media:ro
#     depends_on:
#       - web
#     networks:
#       - luminet-network

# volumes:
#   postgres_data:
#     name: luminet_postgres_data
